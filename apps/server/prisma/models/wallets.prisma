enum WalletStatus {
  ACTIVE
  FROZEN
}

enum WalletTransactionType {
  DEPOSIT
  DEBIT
  REFUND
  ADJUSTMENT
}

enum WalletTransactionStatus {
  SUCCESS
  PENDING
  FAILED
}

model Wallet {
  id        String       @id @default(uuid(7)) @db.Uuid
  userId    String       @unique @map("user_id") @db.Uuid
  balance   BigInt       @default(0) @db.BigInt
  status    WalletStatus @default(ACTIVE)
  createdAt DateTime     @default(now()) @map("created_at") @db.Timestamptz
  updatedAt DateTime     @updatedAt @map("updated_at") @db.Timestamptz

  user         User                @relation(fields: [userId], references: [id])
  transactions WalletTransaction[]
  paymentAttempts PaymentAttempt[]

  @@index([status], name: "idx_wallets_status")
  @@map("wallets")
}

model WalletTransaction {
  id          String                  @id @default(uuid(7)) @db.Uuid
  walletId    String                  @map("wallet_id") @db.Uuid
  amount      BigInt                  @db.BigInt
  fee         BigInt                  @default(0) @db.BigInt
  description String?                 @db.Text
  hash        String?                 @db.Text
  type        WalletTransactionType
  status      WalletTransactionStatus @default(SUCCESS)
  createdAt   DateTime                @default(now()) @map("created_at") @db.Timestamptz

  wallet Wallet @relation(fields: [walletId], references: [id])

  @@index([walletId], name: "idx_wallet_tx_wallet")
  @@index([type], name: "idx_wallet_tx_type")
  @@unique([hash], name: "uq_wallet_tx_hash", map: "uq_wallet_tx_hash")
  @@map("wallet_transactions")
}
